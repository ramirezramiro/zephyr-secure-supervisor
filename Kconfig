menu "zephyr-secure-supervisor Kconfig application"

config APP_WATCHDOG_BOOT_TIMEOUT_MS
	int "Boot watchdog timeout (ms)"
	default 8000
	range 100 60000
	help
	  Initial watchdog timeout applied during system startup. Use a large
	  value to cover expensive init sequences.

config APP_WATCHDOG_STEADY_TIMEOUT_MS
	int "Steady-state watchdog timeout (ms)"
	default 2000
	range 100 60000
	help
	  Watchdog timeout that the supervisor applies once the system has
	  reached its steady state.

config APP_WATCHDOG_RETUNE_DELAY_MS
	int "Delay before watchdog retune (ms)"
	default 5000
	range 0 60000
	help
	  Duration after boot before the watchdog is tightened to the
	  steady-state timeout.

config APP_RESET_WATCHDOG_THRESHOLD
	int "Watchdog reset storm threshold"
	default 3
	range 1 20
	help
	  Number of consecutive watchdog resets that triggers fallback mode.

config APP_HEALTH_LED_STALE_MS
	int "Visual heartbeat stale threshold (ms)"
	default 1500
	range 100 10000
	help
	  Maximum allowed age of the visible heartbeat thread before it is
	  considered stale.

config APP_HEALTH_SYS_STALE_MS
	int "System heartbeat stale threshold (ms)"
	default 1500
	range 100 10000
	help
	  Maximum allowed age of the system heartbeat before it is
	  considered stale.

config APP_ENABLE_UART_COMMANDS
	bool "Enable UART command handler"
	default y
	help
	  Enable a minimal UART command parser for runtime configuration of
	  watchdog parameters. Disable if RAM usage is too tight.

config APP_PROVISION_GDB_HELPERS
	bool "Enable GDB provisioning helpers"
	default y if APP_PROVISION_BUILD
	help
	  Keeps tiny global buffers in the image so external tools (for example,
	  scripted GDB sessions) can copy Curve25519 material into RAM and call
	  the persistence helpers directly. Disable this outside provisioning
	  builds to squeeze out a handful of bytes of SRAM/flash.

config APP_PROVISION_BUILD
	bool "Provisioning build (UART CLI focus)"
	default n
	help
	  Select this when building a temporary provisioning image. The build
	  trims non-essential workloads (sensor thread, heartbeat cadence) and upsizes
	  the UART command stack so the Curve25519 provisioning command can run
	  safely within 8 KB SRAM. Keep this set to 'n' for production images.

config APP_SAFE_MODE_REBOOT_DELAY_MS
	int "Safe-mode auto reboot delay (ms)"
	default 60000
	range 0 300000
	help
	  When fallback (safe) mode is entered, schedule an automatic warm
	  reboot after this many milliseconds. Set to 0 to keep the system in
	  safe mode indefinitely.

config APP_SENSOR_THREAD_STACK_SIZE
	int "HTS221 sensor thread stack size (bytes)"
	default 704
	range 256 4096
	help
	  Stack allocation used by the dedicated HTS221 polling thread.

config APP_SUPERVISOR_THREAD_STACK_SIZE
	int "Supervisor thread stack size (bytes)"
	default 672
	range 256 4096
	help
	  Controls the stack budget for the watchdog supervisor.

config APP_RECOVERY_THREAD_STACK_SIZE
	int "Recovery thread stack size (bytes)"
	default 512
	range 256 4096
	help
	  Stack allocated for the recovery worker thread that handles safe-mode
	  reboot scheduling.

config APP_SENSOR_SAMPLE_INTERVAL_MS
	int "HTS221 sample interval (ms)"
	default 2000
	range 100 60000
	help
	  How often the HTS221 sensor thread fetches temperature/humidity
	  data while the system is in the normal operating mode.

config APP_SENSOR_SAFE_MODE_INTERVAL_MS
	int "HTS221 sample interval while in safe mode (ms)"
	default 5000
	range 100 120000
	help
	  When fallback/safe mode is active, the sensor thread switches to
	  this slower interval to reduce load while still providing
	  telemetry. Set to the same value as the normal interval to keep a
	  constant cadence.

choice APP_CRYPTO_BACKEND
	prompt "Application crypto backend"
	default APP_CRYPTO_BACKEND_AES
	help
	  Select the asymmetric/symmetric helper that app_crypto.c should use.
	  AES-CTR remains the default, while Curve25519 is an experimental
	  placeholder that makes the code paths compile without shipping the
	  implementation yet.

config APP_CRYPTO_BACKEND_AES
	bool "AES-CTR helper"

config APP_CRYPTO_BACKEND_CURVE25519
	bool "Curve25519 (experimental, stub only)"

endchoice

config APP_USE_AES_ENCRYPTION
	bool "Enable AES encryption helper"
	default y
	help
	  Enables the application-level AES helper that seals telemetry and
	  persistent state before it is logged or transmitted. The Curve25519
	  backend reuses this helper after deriving the session key.

config APP_USE_CURVE25519
	bool "Enable Curve25519 helper (placeholder)"
	default y
	depends on APP_CRYPTO_BACKEND_CURVE25519
	help
	  Builds the Curve25519/X25519 app crypto shim. Provide static secret +
	  peer public keys via the configs below or wire a persistence flow.

config APP_CURVE25519_STATIC_SECRET_HEX
	string "Curve25519 private scalar (hex)"
	default "77076D0A7318A57D3C16C17251B26645DF4C2F87EBC0992AB177FBA51DB92C2A"
	depends on APP_USE_CURVE25519
	help
	  32-byte private scalar encoded as 64 hex characters. On first boot the
	  firmware copies this value into NVS, clamps it per RFC 7748, and uses it
	  to derive the shared secret. If left empty, a scalar is derived from the
	  hardware device ID. Provision tooling should overwrite this with
	  per-device values.

config APP_CURVE25519_STATIC_PEER_PUB_HEX
	string "Curve25519 peer public key (hex)"
	default "DE9EDB7D7B7DC1B4D35B61C2ECE435373F8343C85B78674DADFC7E146F882B4F"
	depends on APP_USE_CURVE25519
	help
	  32-byte peer public key encoded as 64 hex characters. The shared secret
	  derived from this key seeds the AES helper.

config APP_AES_STATIC_KEY_HEX
	string "Static AES key (hex)"
	default "00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF"
	depends on APP_USE_AES_ENCRYPTION
	help
	  128/192/256-bit key encoded as a continuous hex string without
	  spaces. Replace this value in production with a key derived from a
	  secure provisioning flow.

config APP_AES_STATIC_IV_HEX
	string "IV seed (hex)"
	default "000102030405060708090A0B"
	depends on APP_USE_AES_ENCRYPTION
	help
	  96-bit initial IV that is mixed with a runtime counter when the RNG
	  is unavailable. Provide a 24-character hex string (12 bytes).

config APP_PROVISION_CMD_BUFFER
	int "Provisioning UART command buffer size"
	default 512
	depends on APP_ENABLE_UART_COMMANDS
	help
	  Size, in bytes, of the UART command line buffer during provisioning
	  builds. Increase this when sending large ASCII payloads (e.g., prov curve
	  commands) to avoid truncation.

config APP_PROVISION_CMD_STACK
	int "Provisioning UART command thread stack size"
	default 2048
	depends on APP_ENABLE_UART_COMMANDS
	help
	  Stack size, in bytes, for the UART command handler when provisioning
	  builds are enabled. Larger values help absorb complex parsing logic.

config APP_PROVISION_AUTO_PERSIST
	bool "Auto-persist Curve25519 keys on boot"
	default y
	depends on APP_PROVISION_BUILD && APP_CRYPTO_BACKEND_CURVE25519
	help
	  When enabled, the provisioning firmware decodes the build-time
	  CONFIG_APP_CURVE25519_STATIC_* hex strings and writes them into NVS
	  automatically on each boot. This provides a simple provisioning path
	  even when UART provisioning is unavailable.

endmenu

source "Kconfig.zephyr"
