# ==== Core stacks ====
# Previous stable main stack: CONFIG_MAIN_STACK_SIZE=1504
CONFIG_MAIN_STACK_SIZE=1536
# Previous stable ISR stack: CONFIG_ISR_STACK_SIZE=1024
CONFIG_ISR_STACK_SIZE=768
CONFIG_IDLE_STACK_SIZE=256

# ==== Storage / persistence ====
# Flash/NVS requires flash driver enabled explicitly on this part
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y
CONFIG_FLASH_MAP=y
CONFIG_NVS=y

# ---- Console / Serial ----
# CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE was 832/1280 in the stable build
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_SERIAL=y
CONFIG_THREAD_NAME=y
# Restored workqueue stack to stable 1280 B after overflow
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=1280
CONFIG_STACK_SENTINEL=y

# ---- Logging to UART (no printk routing) ----
CONFIG_LOG=y
CONFIG_LOG_BACKEND_UART=y
CONFIG_LOG_MODE_IMMEDIATE=y        # immediate = safest on tiny MCUs
CONFIG_LOG_DEFAULT_LEVEL=3

# Keep printk enabled if the board wants it, but don't route printk into LOG
CONFIG_LOG_PRINTK=n

# ---- Drivers ----
CONFIG_GPIO=y
CONFIG_HWINFO=y                    # for hwinfo_get_reset_cause()
CONFIG_I2C=y
CONFIG_I2C_STM32=y
CONFIG_SENSOR=y
CONFIG_HTS221=y

#our code will control wdg, not default setup
CONFIG_WDT_DISABLE_AT_BOOT=y
CONFIG_WATCHDOG=y

# ---- Fault dump (replace any FATAL_EXCEPTION_DUMP usage) ----
CONFIG_FAULT_DUMP=1              

# Enable reboot & system management
CONFIG_REBOOT=y

# Application tuning
CONFIG_APP_WATCHDOG_BOOT_TIMEOUT_MS=8000
CONFIG_APP_WATCHDOG_STEADY_TIMEOUT_MS=2000
CONFIG_APP_WATCHDOG_RETUNE_DELAY_MS=500
CONFIG_APP_RESET_WATCHDOG_THRESHOLD=3
CONFIG_APP_HEALTH_LED_STALE_MS=6500
CONFIG_APP_HEALTH_SYS_STALE_MS=6500
# Crypto backend selection (Curve25519 derives the AES session key)
# CONFIG_APP_CRYPTO_BACKEND_AES is not set
CONFIG_APP_CRYPTO_BACKEND_CURVE25519=y
CONFIG_APP_ENABLE_UART_COMMANDS=n
CONFIG_APP_SAFE_MODE_REBOOT_DELAY_MS=60000
# Previous stable sensor stack: CONFIG_APP_SENSOR_THREAD_STACK_SIZE=256
CONFIG_APP_SENSOR_THREAD_STACK_SIZE=256
# Previous stable supervisor stack: CONFIG_APP_SUPERVISOR_THREAD_STACK_SIZE=768
CONFIG_APP_SUPERVISOR_THREAD_STACK_SIZE=768
# Previous stable recovery stack: CONFIG_APP_RECOVERY_THREAD_STACK_SIZE=384
CONFIG_APP_RECOVERY_THREAD_STACK_SIZE=384
# AES helper stays enabled to seal telemetry with the derived curve key
CONFIG_APP_USE_AES_ENCRYPTION=y
CONFIG_APP_USE_CURVE25519=y
# Static Curve25519 material (replace in production)
CONFIG_APP_CURVE25519_STATIC_SECRET_HEX="77076D0A7318A57D3C16C17251B26645DF4C2F87EBC0992AB177FBA51DB92C2A"
CONFIG_APP_CURVE25519_STATIC_PEER_PUB_HEX="DE9EDB7D7B7DC1B4D35B61C2ECE435373F8343C85B78674DADFC7E146F882B4F"

# Thread configuration
CONFIG_THREAD_MONITOR=y
CONFIG_THREAD_STACK_INFO=y
# Analyzer disabled during curve prototype to reclaim ~768 B stack
# CONFIG_THREAD_ANALYZER is not set
# CONFIG_THREAD_ANALYZER_AUTO is not set

# Recovery + supervisor require event support
CONFIG_EVENTS=y
